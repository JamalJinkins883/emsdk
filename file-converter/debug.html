<!DOCTYPE html>
<html>
<head>
    <title>WASM Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #ddd; }
        .log { background: #2d2d2d; padding: 10px; margin: 10px 0; border-left: 4px solid #3498db; }
        .error { border-left-color: #e74c3c; color: #e74c3c; }
        .success { border-left-color: #27ae60; color: #27ae60; }
        .info { color: #3498db; }
        pre { background: #1a1a1a; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>WebAssembly Module Debug</h1>
    <div id="debug"></div>

    <script>
        function log(msg, type = 'info') {
            const debug = document.getElementById('debug');
            const div = document.createElement('div');
            div.className = 'log ' + type;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            debug.appendChild(div);
            console.log(msg);
        }

        log('1. Script started', 'info');
        
    </script>
    
    <script src="converter.js"></script>
    
    <script>
        log('2. converter.js loaded, checking Module...', 'info');
        
        if (typeof Module === 'undefined') {
            log('❌ Module is undefined!', 'error');
        } else {
            log('✅ Module exists: ' + typeof Module, 'success');
            
            const keys = Object.keys(Module || {}).filter(k => !k.startsWith('_'));
            log(`Keys in Module (first 10): ${keys.slice(0, 10).join(', ')}`, 'info');
            
            if (Module.FileConverter) {
                log('✅ Module.FileConverter found!', 'success');
            } else {
                log('❌ Module.FileConverter NOT found', 'error');
                if (Module.ccall && Module.cwrap) {
                    log('But Module has ccall/cwrap, so WASM loaded', 'info');
                }
            }
        }
        
        // Try async check
        let checkCount = 0;
        const interval = setInterval(() => {
            checkCount++;
            if (checkCount > 50) {
                log('❌ Timeout waiting for FileConverter', 'error');
                clearInterval(interval);
                return;
            }
            
            if (typeof Module !== 'undefined' && Module.FileConverter) {
                log(`✅ FileConverter became available after ${checkCount * 100}ms!`, 'success');
                clearInterval(interval);
                
                try {
                    const converter = new Module.FileConverter();
                    log('✅ Created FileConverter instance', 'success');
                    converter.addFile('test.cpp', 'C++ Source', '#include <iostream>');
                    const count = converter.getFileCount();
                    log(`✅ Added file, count: ${count}`, 'success');
                    converter.delete();
                } catch (e) {
                    log(`❌ Error using FileConverter: ${e.message}`, 'error');
                    log(`Stack: ${e.stack}`, 'error');
                }
            }
        }, 100);
        
    </script>
</body>
</html>
