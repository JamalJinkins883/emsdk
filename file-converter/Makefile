.PHONY: build clean help server

# Colors for output
GREEN := \033[0;32m
YELLOW := \033[0;33m
RED := \033[0;31m
NC := \033[0m # No Color

help:
	@echo "$(GREEN)File Converter Build System$(NC)"
	@echo ""
	@echo "Available targets:"
	@echo "  $(YELLOW)make build$(NC)    - Build WebAssembly module"
	@echo "  $(YELLOW)make clean$(NC)    - Remove build artifacts"
	@echo "  $(YELLOW)make server$(NC)   - Start development server"
	@echo "  $(YELLOW)make help$(NC)     - Show this help message"

build:
	@echo "$(GREEN)üî® Building File Converter...$(NC)"
	@mkdir -p build
	@echo "$(YELLOW)üì¶ Compiling converter.cpp...$(NC)"
	emcc converter.cpp \
		-o build/converter.js \
		--bind \
		-s WASM=1 \
		-s ALLOW_MEMORY_GROWTH=1 \
		-s EXPORTED_RUNTIME_METHODS='["ccall","cwrap"]' \
		-O3
	@if [ $$? -eq 0 ]; then \
		echo "$(GREEN)‚úÖ Compilation successful!$(NC)"; \
		echo "$(YELLOW)üìÇ Build output:$(NC)"; \
		ls -lh build/; \
	else \
		echo "$(RED)‚ùå Compilation failed!$(NC)"; \
		exit 1; \
	fi

clean:
	@echo "$(YELLOW)üóëÔ∏è  Cleaning build artifacts...$(NC)"
	@rm -rf build/
	@echo "$(GREEN)‚úÖ Clean complete$(NC)"

server:
	@echo "$(GREEN)üöÄ Starting development server...$(NC)"
	@echo "$(YELLOW)üìñ Open http://localhost:8000 in your browser$(NC)"
	python3 -m http.server 8000 --directory .

# Run build by default if just called
all: build
